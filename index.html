<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PageBook - Firebase All-in-One</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; }
    header { background: #3b5998; color: white; padding: 15px 20px; display: flex; justify-content: space-between; }
    nav a { margin-left: 10px; color: white; cursor: pointer; }
    section { display: none; max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 10px; }
    .post { border: 1px solid #ccc; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
    .post h3 { margin: 0; }
    input, textarea, button { width: 100%; padding: 10px; margin: 10px 0; }
    button { background: #1877f2; color: white; border: none; cursor: pointer; }
    button:hover { background: #145dbf; }
  </style>
</head>

<body onload="loadPosts()">
  <header>
    <h1>PageBook</h1>
    <nav>
      <a onclick="showSection('home')">Home</a>
      <a onclick="showSection('post')">Post</a>
      <a onclick="showSection('login')">Login</a>
    </nav>
  </header>

  <section id="home" style="display:block">
    <h2>Recent Posts</h2>
    <div id="recentPosts">Loading...</div>
  </section>

  <section id="post">
    <h2>Create a Post</h2>
    <input id="postTitle" placeholder="Title">
    <textarea id="postContent" placeholder="What's on your mind?"></textarea>
    <input id="postImage" placeholder="Image URL (optional)">
    <button onclick="createPost()">Post</button>
  </section>

  <section id="login">
    <h2>Login</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </section>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBevLNp5ZnrnBol3Kp0FCR_uyS1eqcWQCY",
      authDomain: "weminthu-2b12a.firebaseapp.com",
      projectId: "weminthu-2b12a",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    function showSection(id) {
      document.querySelectorAll("section").forEach(s => s.style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function loadPosts() {
      const container = document.getElementById("recentPosts");
      container.innerHTML = "Loading...";
      db.collection("posts").orderBy("time", "desc").get().then(snapshot => {
        container.innerHTML = "";
        snapshot.forEach(doc => {
          const p = doc.data();
          const div = document.createElement("div");
          div.className = "post";
          div.innerHTML = `<h3>${p.title}</h3><p>${p.content}</p>${p.image ? `<img src="${p.image}" style="max-width:100%">` : ""}`;
          container.appendChild(div);
        });
      });
    }

    function createPost() {
      const title = document.getElementById("postTitle").value;
      const content = document.getElementById("postContent").value;
      const image = document.getElementById("postImage").value;
      const user = auth.currentUser;

      if (!user) return alert("Login first");

      db.collection("posts").add({
        title,
        content,
        image,
        time: firebase.firestore.FieldValue.serverTimestamp(),
        name: user.email
      }).then(() => {
        alert("Posted!");
        loadPosts();
        showSection("home");
      });
    }

    function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          alert("Logged in!");
          showSection("post");
        })
        .catch(err => alert(err.message));
    }
  </script>
</body>
</html>
