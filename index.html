
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Social Media Demo</title>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    button { margin: 0.5rem; }
    #video { width: 320px; border: 1px solid #ccc; margin-top: 1rem; }
    .post, .message { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Authentication</h2>
<button id="loginBtn">Login with Google</button>
<button id="logoutBtn">Logout</button>

<h2>Create a Post</h2>
<textarea id="postContent" placeholder="What's on your mind?" rows="3" cols="40"></textarea><br>
<button id="postBtn">Post</button>

<h3>Posts</h3>
<div id="posts"></div>

<h2>Livestream</h2>
<video id="video" autoplay muted></video>

<h2>Chat Messages</h2>
<input type="text" id="msgInput" placeholder="Type a message">
<button id="sendMsgBtn">Send</button>
<div id="messages"></div>

<script defer>
window.addEventListener('DOMContentLoaded', function () {
  const firebaseConfig = {
    apiKey: "AIzaSyBevLNp5ZnrnBol3Kp0FCR_uyS1eqcWQCY",
    authDomain: "weminthu-2b12a.firebaseapp.com",
    projectId: "weminthu-2b12a",
    storageBucket: "weminthu-2b12a.appspot.com",
    messagingSenderId: "181634107230",
    appId: "1:181634107230:web:9fb4cfb725b1b5cd1bf1cf",
    measurementId: "G-VFYC7DEVM1"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  let currentUser = null;

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const postBtn = document.getElementById("postBtn");
  const sendMsgBtn = document.getElementById("sendMsgBtn");

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      console.log("Logged in:", user.email);
      loadPosts();
      loadMessages();
    } else {
      console.log("Logged out");
    }
  });

  postBtn.onclick = () => {
    const content = document.getElementById("postContent").value.trim();
    if (!currentUser || !content) return;
    db.collection("posts").add({
      uid: currentUser.uid,
      content: content,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      document.getElementById("postContent").value = '';
      loadPosts();
    });
  };

  function loadPosts() {
    db.collection("posts").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      const container = document.getElementById("posts");
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const post = doc.data();
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <p>${post.content}</p>
          ${post.uid === currentUser?.uid ? `<button onclick="deletePost('${doc.id}')">Delete</button>` : ""}
        `;
        container.appendChild(div);
      });
    });
  }

  window.deletePost = function (id) {
    db.collection("posts").doc(id).delete();
  }

  sendMsgBtn.onclick = () => {
    const msg = document.getElementById("msgInput").value.trim();
    if (!currentUser || !msg) return;
    db.collection("messages").add({
      uid: currentUser.uid,
      text: msg,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      document.getElementById("msgInput").value = '';
    });
  };

  function loadMessages() {
    db.collection("messages").orderBy("createdAt", "desc").limit(10).onSnapshot(snapshot => {
      const container = document.getElementById("messages");
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const msg = doc.data();
        const div = document.createElement("div");
        div.className = "message";
        div.textContent = msg.text;
        container.appendChild(div);
      });
    });
  }

  // Livestream
  navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    .then(stream => {
      document.getElementById("video").srcObject = stream;
    })
    .catch(console.error);
});
</script>
</body>
</html>
