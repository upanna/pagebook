<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Social Feed</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0003e1; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: auto; padding: 20px; display: flex; gap: 20px; }
    .left, .right { flex: 1; }
    .center { flex: 2; background: #fff; padding: 20px; border-radius: 10px; }
    textarea, input[type="url"], input[type="text"], input[type="password"], input[type="email"] {
      width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px;
    }
    button { padding: 10px 15px; margin-top: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .post { border-top: 1px solid #ccc; margin-top: 20px; padding-top: 10px; }
    .actions button { margin-right: 10px; }
    .comment { margin-left: 10px; font-size: 0.9rem; color: #333; }
    .comment-input { width: 80%; padding: 6px; margin-top: 5px; }
    .share-options a { margin-right: 10px; display: inline-block; }
    #user-list img { border-radius: 50%; margin-right: 5px; }
  </style>
</head>
<body>
  <img src="https://placehold.co/1200x200?text=Welcome+to+Page+Book" style="width:100%; display:block;">
  <div class="container">
    <div class="left">
      <div id="auth">
        <input type="text" id="displayName" placeholder="Display Name" />
        <input type="email" id="email" placeholder="Email" />
        <input type="password" id="password" placeholder="Password" />
        <button id="login">Login</button>
        <button id="signup">Sign Up</button>
        <button id="logout" style="display:none;">Logout</button>
        
      </div>
      <h4>üë• Users</h4>
      <div id="user-list"></div>
    </div>
    <div class="center">
      <form id="post-form" style="display:none;">
        <textarea id="post-text" placeholder="What's on your mind?" required></textarea>
        <input type="url" id="post-image" placeholder="Image URL (optional)">
        <button type="submit">Post</button>
      </form>
      <h3>üìù Latest Posts</h3>
      <div id="posts"></div>
    </div>
    <div class="right"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBevLNp5ZnrnBol3Kp0FCR_uyS1eqcWQCY",
      authDomain: "weminthu-2b12a.firebaseapp.com",
      projectId: "weminthu-2b12a",
      storageBucket: "weminthu-2b12a.appspot.com",
      messagingSenderId: "181634107230",
      appId: "1:181634107230:web:9fb4cfb725b1b5cd1bf1cf"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;

    const $ = id => document.getElementById(id);
    const postsDiv = $("posts"), userListDiv = $("user-list");

    auth.onAuthStateChanged(user => {
      currentUser = user;
      $("post-form").style.display = user ? 'block' : 'none';
      $("logout").style.display = user ? 'inline-block' : 'none';
      $("login").style.display = $("signup").style.display = user ? 'none' : 'inline-block';
    });

    $("signup").onclick = async () => {
      const name = $("displayName").value;
      const email = $("email").value;
      const pass = $("password").value;
      const userCred = await auth.createUserWithEmailAndPassword(email, pass);
      await userCred.user.updateProfile({ displayName: name });
      await db.collection("users").doc(userCred.user.uid).set({
        name, email, photo: `https://api.dicebear.com/6.x/initials/svg?seed=${name}`
      });
    };

    $("login").onclick = () => auth.signInWithEmailAndPassword($("email").value, $("password").value);
    $("logout").onclick = () => auth.signOut();

    $("post-form").onsubmit = async e => {
      e.preventDefault();
      const text = $("post-text").value, img = $("post-image").value;
      if (!text || !currentUser) return;
      await db.collection("posts").add({
        text, image: img, uid: currentUser.uid,
        authorName: currentUser.displayName, createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        likes: 0, comments: []
      });
      $("post-text").value = ""; $("post-image").value = "";
    };

    db.collection("posts").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      postsDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const d = doc.data();
        const isOwner = currentUser && currentUser.uid === d.uid;
        const date = d.createdAt?.toDate().toLocaleString() || "";
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <p><strong>${d.authorName || 'Anonymous'}</strong> <small>${date}</small><br>${d.text}</p>
          ${d.image ? `<img src="${d.image}" style="max-width:100%; margin-top:10px;">` : ""}
          <div class="actions">
            <button onclick="like('${doc.id}')">‚ù§Ô∏è Like (${d.likes || 0})</button>
            <button onclick="toggleShare('${doc.id}')">üîó Share</button>
            ${isOwner ? `<button onclick="edit('${doc.id}', '${d.text.replace(/'/g, "\'")}')">‚úèÔ∏è Edit</button>
            <button onclick="del('${doc.id}')">üóëÔ∏è Delete</button>` : ""}
          </div>
          <div id="share-${doc.id}" class="share-options" style="display:none;">
            <a href="https://www.facebook.com/sharer/sharer.php?u=${location.href}" target="_blank">Facebook</a>
            <a href="https://t.me/share/url?url=${location.href}" target="_blank">Telegram</a>
            <a href="viber://forward?text=${location.href}">Viber</a>
          </div>
          <div class="comments">
            ${(d.comments || []).map(c => `<div class='comment'>üí¨ ${c}</div>`).join('')}
            <input class='comment-input' placeholder='Write a comment...' onkeypress='comment(event, "${doc.id}")'>
          </div>`;
        postsDiv.appendChild(div);
      });
    });

    function like(id) {
      const ref = db.collection("posts").doc(id);
      ref.get().then(snap => ref.update({ likes: (snap.data().likes || 0) + 1 }));
    }
    function edit(id, text) {
      const newText = prompt("Edit your post:", text);
      if (newText) db.collection("posts").doc(id).update({ text: newText });
    }
    function del(id) {
      if (confirm("Delete this post?")) db.collection("posts").doc(id).delete();
    }
    function comment(e, id) {
      if (e.key === "Enter") {
        const text = e.target.value.trim();
        if (text) {
          db.collection("posts").doc(id).update({ comments: firebase.firestore.FieldValue.arrayUnion(text) });
          e.target.value = "";
        }
      }
    }
    function toggleShare(id) {
      document.querySelectorAll('.share-options').forEach(el => el.style.display = 'none');
      document.getElementById('share-' + id).style.display = 'block';
    }

    db.collection("users").onSnapshot(snap => {
      userListDiv.innerHTML = "";
      snap.forEach(doc => {
        const u = doc.data();
        userListDiv.innerHTML += `<div><img src="${u.photo}" width="24"> ${u.name}</div>`;
      });
    });
  </script>
</body>
</html>
